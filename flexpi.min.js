flex={api_url:"http://api.flexpi.com:3001/",social:{facebook:{}},settings:{social:{facebook:{}}}};flex.extend=function(a,b){for(var c in b){try{if(b[c].constructor==Object){a[c]=MergeRecursive(a[c],b[c])}else{a[c]=b[c]}}catch(d){a[c]=b[c]}}return a};flex.loader=function(a,b){for(var c=a.length,d=c,e=function(){if(!(this.readyState&&this.readyState!=="complete"&&this.readyState!=="loaded")){this.onload=this.onreadystatechange=null;--d||b()}},f=document.getElementsByTagName("head")[0],g=function(a){var b=document.createElement("script");b.async=true;b.src=a;b.onload=b.onreadystatechange=e;f.appendChild(b)};c;)g(a[--c])};flex.connect=function(a,b){flex.appData=a;var c=[];c[0]=flex.api_url+"socket.io/socket.io.js";flex.loader(c,function(){flex.socket=io.connect(flex.api_url);flex.socket.on("connect",function(a){flex.readSettings();if(typeof b!="undefined"){b(a)}})})};flex.readSettings=function(){flex.socket.emit("settings",{app_id:flex.appData.app_id},function(a){flex.settings=flex.extend(flex.settings,a)})};flex.stats=function(a,b,c){flex.socket.emit("stats",{app_id:flex.appData.app_id,key:a,value:b},function(a){if(typeof c!="undefined"){c(a)}})};flex.social.facebook.init=function(a,b){if(typeof flex.settings.social.facebook.appId=="undefined"){return{error:{code:401,message:"First configure FlexSocial."}}}if(typeof FB!="undefined"){if(typeof a!="undefined"){a()}return true}var c=[],d=flex.settings.social.facebook;if(b==undefined){b=d.lang}var e=document.getElementsByTagName("head")[0],f=document.createElement("div");if(e.length==0){f.id="fb-root";e.appendChild(f,e.firstChild)}c[0]="//connect.facebook.net/"+b+"/all.js";flex.loader(c,function(){window.fbAsyncInit=function(){FB.init({appId:d.appId,status:true,cookie:true,xfbml:true,oauth:true});if(typeof a!="undefined"){a()}}})};flex.social.facebook.isFacebookFrame=function(){if(window!=window.top){return true}return false};flex.social.facebook.feed=function(a,b){flex.social.facebook.init(function(){FB.ui({method:"feed",message:a.message,name:a.name,link:a.link,picture:a.picture},function(a){if(typeof b!="undefined"){b(a)}})})};flex.social.facebook.login=function(a,b){if(b==undefined){b={}}flex.social.facebook.init(function(){FB.login(function(b){if(typeof a!="undefined"){a(b)}},{scope:b})})};flex.social.facebook.logout=function(a){flex.social.facebook.init(function(){FB.logout(function(b){if(typeof a!="undefined"){a(b)}})})};flex.social.facebook.requests=function(a,b){if(!flex.social.facebook.isFacebookFrame()){return false}if(a!=undefined){a=flex.extend({method:"apprequests",message:"My Great Request"},a)}flex.social.facebook.init(function(){FB.ui(a,function(a){if(typeof b!="undefined"){b(a)}})})};flex.social.facebook.message=function(a){var b={method:"send",link:"http://www.flexpi.com",name:"FlexPi - games services"};if(a!=undefined){a=flex.extend(b,a)}else{a=b}flex.social.facebook.init(function(){FB.ui(a)})};flex.social.facebook.getFb=function(){return FB};flex.social.facebook.getLoginStatus=function(a){flex.social.facebook.init(function(){FB.getLoginStatus(function(b){if(typeof a!="undefined"){a(b)}})})};flex.social.facebook.getUser=function(a){flex.social.facebook.init(function(){flex.social.facebook.getLoginStatus(function(b){if(b.status==="connected"){FB.api("/me",function(b){a(b)})}else{a({error:{code:2500,message:"An active access token must be used to query information about the current user.",type:"OAuthException"}})}})})}