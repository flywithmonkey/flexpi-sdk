flex={api_url:"http://api.flexpi.com:3001/",social:{facebook:{},browserid:{},gg:{callback:{login:false,logout:false}}},payment:{cart:{},transactions:{},cartData:[],paypal:{}},settings:{social:{facebook:{},gg:{ready:false}},payment:{paypal:{}}}};flex.extend=function(a,b){for(var c in b){try{if(b[c].constructor==Object){a[c]=flex.extend(a[c],b[c])}else{a[c]=b[c]}}catch(d){a[c]=b[c]}}return a};flex.loader=function(a,b,c){for(var d=a.length,e=d,f=function(){if(!(this.readyState&&this.readyState!=="complete"&&this.readyState!=="loaded")){this.onload=this.onreadystatechange=null;--e||b()}},g=document.getElementsByTagName("head")[0],h=function(a){var b=document.createElement("script");b.async=true;b.src=a;if(typeof c!="undefined"){b.id=c}b.onload=b.onreadystatechange=f;g.appendChild(b)};d;)h(a[--d])};flex.connect=function(a,b){flex.appData=a;var c=[];c[0]=flex.api_url+"socket.io/socket.io.js";flex.loader(c,function(){flex.socket=io.connect(flex.api_url);flex.socket.on("connect",function(a){flex.readSettings();if(typeof b!="undefined"){b(a)}})})};flex.readSettings=function(){flex.socket.emit("settings",{app_id:flex.appData.app_id},function(a){if(typeof a.code!="undefined"){flex.settings=a}else{flex.settings=flex.extend(flex.settings,a)}})};flex.stats=function(a,b,c){flex.socket.emit("stats",{app_id:flex.appData.app_id,key:a,value:b},function(a){if(typeof c!="undefined"){c(a)}})};flex.social.facebook.init=function(a,b){if(typeof flex.settings.social.facebook.appId=="undefined"){return{error:{code:401,message:"First configure FlexSocial with Facebook."}}}if(typeof FB!="undefined"){if(typeof a!="undefined"){a()}return true}var c=[],d=flex.settings.social.facebook;if(b==undefined){b=d.lang}var e=document.getElementsByTagName("head")[0],f=document.createElement("div");if(e.length==0){f.id="fb-root";e.appendChild(f,e.firstChild)}c[0]="//connect.facebook.net/"+b+"/all.js";flex.loader(c,function(){window.fbAsyncInit=function(){FB.init({appId:d.appId,status:true,cookie:true,xfbml:true,oauth:true});if(typeof a!="undefined"){a()}}})};flex.social.facebook.isFacebookFrame=function(){if(window!=window.top){return true}return false};flex.social.facebook.feed=function(a,b){flex.social.facebook.init(function(){FB.ui({method:"feed",message:a.message,name:a.name,link:a.link,picture:a.picture},function(a){if(typeof b!="undefined"){b(a)}})})};flex.social.facebook.login=function(a,b){if(b==undefined){b={}}flex.social.facebook.init(function(){FB.login(function(b){if(typeof a!="undefined"){a(b)}},{scope:b})})};flex.social.facebook.logout=function(a){flex.social.facebook.init(function(){FB.logout(function(b){if(typeof a!="undefined"){a(b)}})})};flex.social.facebook.requests=function(a,b){if(!flex.social.facebook.isFacebookFrame()){return false}if(a!=undefined){a=flex.extend({method:"apprequests",message:"My Great Request"},a)}flex.social.facebook.init(function(){FB.ui(a,function(a){if(typeof b!="undefined"){b(a)}})})};flex.social.facebook.message=function(a){var b={method:"send",link:"http://www.flexpi.com",name:"FlexPi - games services"};if(a!=undefined){a=flex.extend(b,a)}else{a=b}flex.social.facebook.init(function(){FB.ui(a)})};flex.social.facebook.getFb=function(){return FB};flex.social.facebook.getLoginStatus=function(a){flex.social.facebook.init(function(){FB.getLoginStatus(function(b){if(typeof a!="undefined"){a(b)}})})};flex.social.facebook.getUser=function(a){flex.social.facebook.init(function(){flex.social.facebook.getLoginStatus(function(b){if(b.status==="connected"){FB.api("/me",function(b){a(b)})}else{a({error:{code:2500,message:"An active access token must be used to query information about the current user.",type:"OAuthException"}})}})})};flex.social.browserid.verify=function(a,b){flex.socket.emit("browseridVerify",{app_id:flex.appData.app_id,assertion:a,audience:window.location.hostname},function(a){if(typeof b!="undefined"){b(a)}})};flex.social.browserid.init=function(a){var b=[];b[0]="https://browserid.org/include.js";flex.loader(b,function(){if(typeof a!="undefined"){a()}},"flex-social-script-browserID")};flex.social.browserid.login=function(a){if(document.getElementById("flex-social-script-browserID")){navigator.id.get(function(b){if(b){flex.social.browserid.verify(b,function(c){if(typeof a!="undefined"){a(true,c,b)}})}else{if(typeof a!="undefined"){a(false,{})}}},{allowPersistent:true})}else{return false}};flex.social.browserid.logout=function(a){window.navigator.id.logout(function(){if(typeof a!="undefined"){a()}})};flex.social.gg.init=function(a){if(typeof flex.settings.social.gg.client_id=="undefined"){return{error:{code:401,message:"First configure FlexSocial with GG."}}}if(!document.getElementById("flex-social-script-gg")){var b=[],c=new Date;b[0]="//login.gg.pl/js/libs/0.9/gg.js";flex.loader(b,function(){},"flex-social-script-gg");window.ggReady=function(){flex.settings.social.gg.ready=true;gg.initialize({client_id:flex.settings.social.gg.client_id,urlhashUri:flex.settings.social.gg.urlhashUri},function(a){if(typeof flex.social.gg.callback.login=="function"){flex.social.gg.callback.login(a)}},function(a){if(typeof flex.social.gg.callback.logout=="function"){flex.social.gg.callback.logout(a)}});if(typeof a!="undefined"){a()}}}else{a()}};flex.social.gg.login=function(a,b){if(!flex.settings.social.gg.ready){return{error:{code:401,message:"First run 'flex.social.gg.init'."}}}if(typeof a!="undefined"){flex.social.gg.callback.login=a}gg.Connect.login(function(){if(typeof b!="undefined"){b()}})};flex.social.gg.logout=function(a){if(!flex.settings.social.gg.ready){return{error:{code:401,message:"First run 'flex.social.gg.init'."}}}if(typeof a!="undefined"){flex.social.gg.callback.logout=a}gg.Connect.logout()};flex.social.gg.getLoginStatus=function(a){if(!flex.settings.social.gg.ready){return{error:{code:401,message:"First run 'flex.social.gg.init'."}}}gg.Connect.getLoginStatus(function(b){if(typeof a!="undefined"){a(b)}})};flex.social.gg.getUser=function(a){if(!flex.settings.social.gg.ready){return{error:{code:401,message:"First run 'flex.social.gg.init'."}}}flex.social.gg.getLoginStatus(function(b){var c=function(){gg.api.pubdir.get(b.userId,function(b){if(typeof a!="undefined"){a(b)}})};if(typeof b.userId=="undefined"){flex.social.gg.login(function(){flex.social.gg.getLoginStatus(function(a){c()})})}else{c()}})};flex.social.gg.getGg=function(){if(!flex.settings.social.gg.ready){return{error:{code:401,message:"First run 'flex.social.gg.init'."}}}return gg};flex.payment.init=function(a,b){var c=[],d=new Date;c[0]="//flexpi.com/api/store.js";flex.loader(c,function(){if(typeof b=="undefined"){b=d.getTime()+"_"+Math.floor(Math.random()*101)}if(typeof store.get("cart")!="undefined"){flex.payment.cartData=store.get("cart")}else{flex.payment.transactions.cartId=b;store.set("transactions",flex.payment.transactions)}store.set("cart",flex.payment.cartData);if(typeof a!="undefined"){a(flex.payment.cartData)}})};flex.payment.cart.get=function(){return flex.payment.cartData};flex.payment.cart.getId=function(){if(typeof store!="undefined"){return store.get("transactions").cartId}else{return{error:{code:401,message:"First run 'flex.payment.init'."}}}};flex.payment.cart.add=function(a,b,c,d){var e=flex.payment.cartData.length;flex.payment.cartData[e]={item_name:a,amount:b,quantity:c};store.set("cart",flex.payment.cartData);if(typeof d!="undefined"){d(flex.payment.cartData)}return flex.payment.cartData[e]};flex.payment.cart.remove=function(a,b){var c=[];if(typeof flex.payment.cartData[a]!="undefined"){delete flex.payment.cartData[a]}for(i=0;i<=flex.payment.cartData.length;i++){if(typeof flex.payment.cartData[i]!="undefined"){c.push(flex.payment.cartData[i])}}flex.payment.cartData=c;store.set("cart",flex.payment.cartData);if(typeof b!="undefined"){b(flex.payment.cartData)}};flex.payment.transactions.get=function(a,b){flex.socket.emit("getPaymentTransaction",{app_id:flex.appData.app_id,transactionId:a},function(a){if(typeof b!="undefined"){b(a)}})};flex.payment.transactions.clear=function(){if(typeof store!="undefined"){store.remove("transactions");store.remove("cart");return true}else{return{error:{code:401,message:"First run 'flex.payment.init'."}}}};flex.payment.paypal.createFormView=function(a,b){var c=document.getElementById(a);if(flex.payment.paypal.init()!=true){return flex.payment.paypal.init()}if(typeof c=="undefined"){return{error:{code:404,message:"Element "+a+" dont exist."}}}if(flex.payment.cartData.length==0){return{error:{code:401,message:"Cart doesn't have any items"}}}if(typeof b=="undefined"){b="Pay with Paypal"}var d=document.createElement("form");d.setAttribute("action","https://www.paypal.com/cgi-bin/webscr");d.setAttribute("method","post");d.setAttribute("id","flex-payment-paypal");var e=document.createElement("input");e.setAttribute("hidden",true);e.setAttribute("name","cmd");e.setAttribute("value","_cart");var f=document.createElement("input");f.setAttribute("hidden",true);f.setAttribute("name","custom");f.setAttribute("value",store.get("transactions").cartId+"___"+flex.appData.app_id);var g=document.createElement("input");g.setAttribute("hidden",true);g.setAttribute("name","upload");g.setAttribute("value",1);var h=document.createElement("input");h.setAttribute("hidden",true);h.setAttribute("name","currency_code");h.setAttribute("value",flex.settings.payment.paypal.currency);var j=document.createElement("input");j.setAttribute("hidden",true);j.setAttribute("name","notify_url");j.setAttribute("value","http://flexpi.com/api/payment/paypal/ipn");var k=document.createElement("input");k.setAttribute("hidden",true);k.setAttribute("name","business");k.setAttribute("value",flex.settings.payment.paypal.email);d.appendChild(e);d.appendChild(f);d.appendChild(g);d.appendChild(h);d.appendChild(k);var l,m,n;for(i=0;i<flex.payment.cartData.length;i++){l=document.createElement("input");l.setAttribute("hidden",true);l.setAttribute("name","item_name_"+(i+1));l.setAttribute("value",flex.payment.cartData[i].item_name);m=document.createElement("input");m.setAttribute("hidden",true);m.setAttribute("name","amount_"+(i+1));m.setAttribute("value",flex.payment.cartData[i].amount.toFixed(2));n=document.createElement("input");n.setAttribute("hidden",true);n.setAttribute("name","quantity_"+(i+1));n.setAttribute("value",parseInt(flex.payment.cartData[i].quantity,10));d.appendChild(l);d.appendChild(m);d.appendChild(n)}var o=document.createElement("input");o.setAttribute("type","submit");o.setAttribute("class","flex-payment-paypal-send");o.setAttribute("value",b);d.appendChild(o);c.appendChild(d)};flex.payment.paypal.init=function(){if(typeof flex.settings.payment.paypal.email=="undefined"||typeof flex.settings.payment.paypal.currency=="undefined"){return{error:{code:401,message:"First configure FlexPayment for PayPal."}}}return true}